<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Thanh toán</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f4f8fb;
      margin: 0;
      padding: 0;
      color: #333;
    }

    .container {
      max-width: 800px;
      margin: 60px auto 40px auto; /* cách header phía trên */
      background-color: white;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.1);
    }

    h2 {
      color: #63aaf7;
      margin-bottom: 24px;
      font-size: 26px;
      font-weight: 600;
      text-align: center;
    }

    .form-group {
      margin-bottom: 20px;
    }

    label {
      display: block;
      font-weight: 600;
      margin-bottom: 6px;
    }

    input[type="text"],
    input[type="email"],
    input[type="tel"],
    textarea,
    select {
      width: 100%;
      padding: 10px 14px;
      border: 1px solid #ccc;
      border-radius: 6px;
      box-sizing: border-box;
      font-size: 15px;
    }

    textarea {
      resize: vertical;
      min-height: 80px;
    }

    .payment-methods {
      margin-top: 20px;
    }

    .payment-methods label {
      font-weight: normal;
      margin-left: 4px;
    }

    .btn {
      background-color: #63aaf7;
      color: white;
      padding: 14px 24px;
      border: none;
      border-radius: 6px;
      font-size: 16px;
      cursor: pointer;
      margin-top: 24px;
      width: 100%;
      transition: background 0.2s;
    }

    .btn:hover {
      background-color: #0056b3;
    }

    .summary {
      margin-top: 30px;
      border-top: 1px solid #ccc;
      padding-top: 20px;
    }

    .summary p {
      font-size: 16px;
      margin: 6px 0;
    }
  </style>
</head>
<body>

  <div id="header"></div>
  <script>
    fetch('../components/header.html')
      .then(res => res.text())
      .then(data => {
        document.getElementById('header').innerHTML = data;
      });
  </script>

  <div class="container">
    <h2>Thông tin thanh toán</h2>

    <form onsubmit="submitOrder(event)">
      <div class="form-group">
        <label for="name">Họ và tên</label>
        <input type="text" id="name" required>
      </div>

      <div class="form-group">
        <label for="email">Email</label>
        <input type="email" id="email" required>
      </div>

      <div class="form-group">
        <label for="phone">Số điện thoại</label>
        <input type="tel" id="phone" required>
      </div>

      <div class="form-group">
        <label for="address">Địa chỉ giao hàng</label>
        <textarea id="address" required></textarea>
      </div>

      <div class="form-group payment-methods">
        <label>Hình thức thanh toán:</label><br>
        <input type="radio" id="cod" name="payment" value="cod" checked>
        <label for="cod">Thanh toán khi nhận hàng (COD)</label><br>

        <input type="radio" id="bank" name="payment" value="bank">
        <label for="bank">Chuyển khoản ngân hàng</label><br>

        <input type="radio" id="momo" name="payment" value="momo">
        <label for="momo">Momo / Ví điện tử</label>
      </div>

      <div class="summary">
        <p><strong>Tạm tính:</strong> <span id="subtotal">0 ₫</span></p>
        <p><strong>Phí vận chuyển:</strong> Miễn phí</p>
        <p><strong>Tổng thanh toán:</strong> <span id="total">0 ₫</span></p>
      </div>

      <button type="submit" class="btn">Xác nhận đặt hàng</button>
    </form>
  </div>

  <div id="footer" class="mt-20"></div>
  <script>
    fetch('../components/footer.html')
      .then(res => res.text())
      .then(data => {
        document.getElementById('footer').innerHTML = data;
      });
  </script>

  <script>
    function submitOrder(event) {
      event.preventDefault();
      alert("Đặt hàng thành công! Cảm ơn bạn đã mua sắm.");
      localStorage.removeItem('cart');
      localStorage.removeItem('checkoutTotal');
      localStorage.removeItem('buyNowProduct');
      window.location.href = "../index.html";
    }

    // Xử lý hiển thị giá tạm tính và tổng thanh toán
    let subtotal = 0;
    // Kiểm tra có sản phẩm mua ngay không
    const buyNowProduct = localStorage.getItem('buyNowProduct');
    if (buyNowProduct) {
      const product = JSON.parse(buyNowProduct);
      subtotal = product.price * (product.quantity || 1);
    } else {
      // Nếu không có, lấy tổng giỏ hàng
      const cart = JSON.parse(localStorage.getItem('cart')) || [];
      subtotal = cart.reduce((sum, item) => sum + (item.price * (item.quantity || 1)), 0);
    }
    const formatted = Number(subtotal).toLocaleString('vi-VN') + ' ₫';
    document.getElementById('subtotal').textContent = formatted;
    document.getElementById('total').textContent = formatted;
  </script>
</body>
</html>
